@*@model CustApp.Models.DishHomeFundTransfer*@

@{
    ViewBag.Title = "DishHome Payment";

}


<!-- Main content -->
<link href="~/Content/NewIcon/style.css" rel="stylesheet" />
<style>
    .image_icon {
        width: 100px;
    }
</style>


@using (Html.BeginForm("DishHomePayment", "DishHome", FormMethod.Post, new { @id = "DishHomePayment", @name = "DishHomePayment", @class = "form-horizontal", enctype = "multipart/form-data" }))
{
    @Html.AntiForgeryToken()
    @Html.ValidationSummary(true)

    <div class="main-content">
        <div class="two-colbg">
            <div class="container">
                <div class="row">

                    <div class="col-lg-6">
                        <section class="internet-payment pad-50">
                            <div class="top-section">
                                <h2 class="title">DishHome Bill Payment</h2>
                            </div>
                            <div class="instant-transactions">
                                <h3 class="title">Other Merchant Payment</h3>
                                <div class="transactions-grid clearfix">
                                    <div class="item load-wallet">
                                        <div class="item-inner">
                                            <a href="@Url.Action("MerchantRestaurant", "MerchantPayment")">
                                                <div class="content-inner">
                                                    <i class="thaili-icon-restaurant"></i>
                                                    <span>Restaurant</span>
                                                </div>
                                            </a>
                                        </div>
                                    </div>
                                    <!-- /item -->

                                    <div class="item transfer-fund">
                                        <div class="item-inner">
                                            <a href="@Url.Action("MerchantCollege", "MerchantPayment")">
                                                <div class="content-inner">
                                                    <i class="thaili-icon-college"></i>
                                                    <span>College</span>
                                                </div>
                                            </a>
                                        </div>
                                    </div>
                                    <!-- /item -->

                                    <div class="item top-up">
                                        <div class="item-inner">
                                            <a href="@Url.Action("MerchantSchool", "MerchantPayment")">
                                                <div class="content-inner">
                                                    <i class="thaili-icon-school"></i>
                                                    <span>School</span>
                                                </div>
                                            </a>
                                        </div>
                                    </div>
                                    <!-- /item -->

                                    <div class="item top-up">
                                        <div class="item-inner">
                                            <a href="@Url.Action("MerchantInsurance", "MerchantPayment")">
                                                <div class="content-inner">
                                                    <i class="thaili-icon-school"></i>
                                                    <span>Insurance</span>
                                                </div>
                                            </a>
                                        </div>
                                    </div>
                                    <!-- /item -->
                                    <div class="item top-up">
                                        <div class="item-inner">
                                            <a href="@Url.Action("Index", "NEA" )">
                                                <div class="content-inner">
                                                    <i class="thaili-icon-electricity"></i>
                                                    <span>NEA</span>
                                                </div>
                                            </a>
                                        </div>
                                    </div>
                                    <!-- /item -->
                                    <div class="item top-up">
                                        <div class="item-inner">
                                            <a href="@Url.Action("Index", "DishHome" )">
                                                <div class="content-inner">
                                                    <i class="thaili-icon-internet"></i>
                                                    <span>Dish Home</span>
                                                </div>
                                            </a>
                                        </div>
                                    </div>
                                    <!-- /item -->
                                </div>
                            </div>
                        </section>

                    </div>

                    <div class="col-lg-6 right-form">
                        <section class="content-inner pad-50">
                            @if (this.ViewData["DishHome_messsage"] != null)
                            {
                                if (this.ViewData["message_class"].ToString() == "success_info")
                                {
                                    <div class="alert alert-success">
                                        <button type="button" class="close" data-dismiss="alert">&times;</button>
                                        <h4>Success</h4> @this.ViewData["DishHome_messsage"]
                                    </div>
                                }
                                else
                                {
                                    <div class="alert alert-danger">
                                        <button type="button" class="close" data-dismiss="alert">&times;</button>
                                        <h4>Error</h4> @this.ViewData["DishHome_messsage"]
                                    </div>
                                }
                            }

                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="col-sm-12">Customer ID/ Chip ID/ CAS ID:<b style="color:red;">*</b></label>
                                        <input type="text" class="form-control select2" id="CASID" name="txtCASID" placeholder="CAS ID Number" maxlength="20" onkeypress="return isNumberKey(event)" />
                                    </div>
                                </div>
                            </div>
                            <br />

                            @*Hidden Attributes*@
                            <div class="form-group" style="display:none;">
                                <label>Sender Mobile No</label>
                                <input type="text" id="sender" name="txtSenderMobileNo" class="form-control" value="@ViewBag.SenderMobileNo" readonly />
                            </div>

                            <div class="form-group" style="display:none;">
                                <label>T-PIN (<span style="color:red">*</span>)</label>
                                <input type="password" id="pin" name="txtPin" class="form-control pwd1" placeholder="T-PIN" pattern=".{4,4}" required title="Please use T-Pin number" maxlength="4" oninput="checkValidation()" onkeypress="return isNumber(event)" autocomplete="new-password" onpaste="return false" />
                                <span toggle="#password-field" class="fa fa-fw fa-eye field-icon toggle-password, btnShow1"></span>
                            </div>

                            <div class="form-group" style="display:none;">
                                <label>Trace ID</label>
                                <input type="text" id="traceID" name="txtTraceID" class="form-control" value="@ViewBag.TraceID" readonly />
                                @*@Html.EditorFor(model => model.tid, new { htmlAttributes = new { @class = "form-control", @readonly = "readonly", @Value = @ViewBag.TraceID, @name = "txtTraceID", @id = "traceID" } })*@
                            </div>
                            @*Hidden Attributes--END*@

                            <div class="box-footer">
                                <input type="submit" class="btn btn-blue btn-big col-md-5" name="btnCommand" value="Confirm" id="btnSubmit" />

                                <a href="@Url.Action("Index", "DishHome")" class="btn btn-blue btn-big " id="btnNew" title="Begin New Transaction" style="display:none">New Transaction</a>
                                <input type="button" value="Clear" class="btn btn-default btn-big col-md-5" id="clearButton" />
                            </div>

                        </section>
                    </div>

                </div>
            </div>
        </div>
    </div>


    <!-- Success modal -->
    <div class="modal fade common-modal" id="successModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-body text-center">
                    <div class="success-icon">
                        <img src="~/Content/assets/img/success-tick.svg" alt="success-tick">
                    </div>
                    <p class="msg">@*Success!*@</p>
                    <span class="msg">Your payment has been confirmed.</span>
                    <br /> <br />
                    <button type="button" class="btn btn-blue" data-dismiss="modal" style="width:80%">OK</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Failure modal -->
    <div class="modal fade common-modal" id="failureModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-body text-center">
                    <div class="success-icon">
                        <img src="~/Content/assets/img/denied-cross.svg" alt="denied-cross">
                    </div>
                    <p style="color: #E31837; font-size: 1.111rem; font-weight: 700;">@*Error!*@</p>
                    <span style="color: #E31837; font-size: 1.111rem; font-weight: 700;" id="message"></span>
                    <br /> <br />
                    <button type="button" class="btn btn-blue" data-dismiss="modal" style="width:80%">OK</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Failure modal session expired -->
    <div class="modal fade common-modal" id="failureModalSessionExpired" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-body text-center">
                    <div class="success-icon">
                        <img src="~/Content/assets/img/denied-cross.svg" alt="denied-cross">
                    </div>
                    <p style="color: #E31837; font-size: 1.111rem; font-weight: 700;">@*Error!*@</p>
                    <span style="color: #E31837; font-size: 1.111rem; font-weight: 700;">Session expired. Please login again</span>
                    <br /> <br />
                    <button type="button" class="btn btn-blue" data-dismiss="modal" style="width:80%">OK</button>
                </div>
            </div>
        </div>
    </div>
}

@section scripts{
    <script type="text/javascript">

        function isNumber(evt) {
            evt = (evt) ? evt : window.event;
            var charCode = (evt.which) ? evt.which : evt.keyCode;
            if (charCode > 31 && (charCode < 48 || charCode > 57)) {
                return false;
            }
            return true;
        }

        $('#DishHomePayment').bootstrapValidator({
            feedbackIcons: {
                valid: 'glyphicon glyphicon-ok',
                invalid: 'glyphicon glyphicon-remove',
                validating: 'glyphicon glyphicon-refresh'
            },
            fields: {

                txtCASID: {
                    validators: {
                        notEmpty: {
                            message: 'CAS ID is required and cannot be empty'
                        },
                    }
                },
            }
        });


        $("#clearButton").click(function () {

            $("#CASID").val("");
            $("[name='btnCommand']").attr('disabled', 'disabled');
        });
        
        document.getElementById("successModal").onclick = function () {
         var url = '@Url.Action("Index", "UserDashboard")';
         window.location.href = url;
        };
        document.getElementById("failureModalSessionExpired").onclick = function () {
            debugger;
         var url = '@Url.Action("Index", "LogOut")';
         window.location.href = url;
        };




        $('#btnSubmit').click(function (e) {
            
            var CASID = $("[name='txtCASID']").val();
           
            if (CASID != ""){
                var dataToPost = {
                    CASID: CASID,
                };

                e.preventDefault(); //prevent the default action
                $.ajax({
                    url: '@Url.Action("DishHomePayment", "DishHome")',
                    type: "POST",
                    data: dataToPost,
                    async: false,
                    success: function (data) {

                        if (data.responseCode == "200") {
                            $("#ajaxResponse").html("");
                            var resp = JSON.parse(data.responseText);
                            $('#successModal').modal("show");
                            $("#DishHome").val("");

                        }
                        //display error message
                        else {
                            $("#ajaxResponse").html("");
                            $("#message").html("");
                            $("#message").append(data.responseText);
                            if (data.responseText == "Session expired. Please login again") {
                                $('#failureModalSessionExpired').modal("show");
                            }
                            else {
                                $('#failureModal').modal("show");
                            }

                        }
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        alert('Failed to retrieve.');
                        $("#message").html("");
                        $("#message").append(jqXHR.responseText);
                        $('#failureModal').modal("show");

                    },
                    //capture the request before it was sent to server
                    beforeSend: function (jqXHR, settings) {
                        //adding some Dummy data to the request
                        settings.data += "&dummyData=whatever";
                        //disable the button until we get the response
                        $('#btnSubmit').attr("disabled", true);
                    },
                    complete: function (jqXHR, textStatus) {
                        //enable the button
                        $('#btnSubmit').attr("disabled", false);
                    }
                });

            }
            else {
                checkValidation();
                $("#message").html("");
                $("#message").append("Please Enter the required fields.");
                $('#failureModal').modal("show");

            }
        });


    </script>
}
