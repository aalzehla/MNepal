@model MNSuperadmin.Models.Notifications.NotificationModel

@{
    ViewBag.Title = "Push Notifications";

}

<!-- Main content -->
<style>
    .image_icon {
        width: 100px;
    }

    .field-icon {
        float: right;
        margin-left: -25px;
        margin-top: -32px;
        margin-right: 13px;
        position: relative;
        z-index: 2;
    }
</style>

@using (Html.BeginForm("PushNotifications", "Notifications", FormMethod.Post, new { @id = "PushNotifications", @name = "PushNotifications", @class = "form-horizontal", enctype = "multipart/form-data" }))
{
    @Html.AntiForgeryToken()
    @Html.ValidationSummary(true)

    <div class="main-content">
        <div class="two-colbg">
            <div class="container">
                <div class="row">


                    <div class="col-lg-offset-4 col-lg-4 right-form">
                        <section class="content-inner pad-50">
                            @if (this.ViewData["registration_message"] != null)
                            {
                                if (this.ViewData["message_class"].ToString() == "success_info")
                                {
                                    <div class="alert alert-success">
                                        <button type="button" class="close" data-dismiss="alert">&times;</button>
                                        <h4>Success</h4> @this.ViewData["registration_message"]
                                    </div>
                                }
                                else
                                {
                                    <div class="alert alert-danger">
                                        <button type="button" class="close" data-dismiss="alert">&times;</button>
                                        <h4>Error</h4> @this.ViewData["registration_message"]
                                    </div>
                                }
                            }


                            <div class="row" style="margin-top:20px;">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="col-sm-12">Title:<b style="color:red;">*</b></label>
                                        <input type="text" class="form-control select2" id="Title" name="txtTitle" placeholder="Example: Test" maxlength="100" oninput="checkValidation()" />
                                    </div>
                                    <div class="form-group" id="TitleErr" style="color:red; margin-top:-11px;"></div>
                                </div>

                            </div>

                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="col-sm-12">Text:<b style="color:red;">*</b></label>
                                        <input type="text" class="form-control select2" id="Text" name="txtText" placeholder="Example: Test" maxlength="100" oninput="checkValidation()" />
                                    </div>
                                    <div class="form-group" id="TextErr" style="color:red; margin-top:-11px;"></div>
                                </div>

                            </div>

                            <div class="row">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label class="col-sm-12">Extra Informations:<b style="color:red;">*</b></label>
                                        <input type="text" class="form-control select2" id="ExtraInfo" name="txtExtraInfo" placeholder="Example: Test" maxlength="100" oninput="checkValidation()" />
                                    </div>
                                    <div class="form-group" id="ExtraErr" style="color:red; margin-top:-11px;"></div>
                                </div>

                            </div>

                            <br />

                            <div class="box-footer">
                                <input type="submit" class="btn btn-primary btn-big col-md-5" name="btnCommand" value="Send" id="btnSubmit" />
                                <input type="button" value="Clear" class="btn btn-default btn-big col-md-5" id="clearButton" style="margin-left:50px;" />
                            </div>
                        </section>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <!-- Success modal -->
    <div class="modal fade common-modal" id="successModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-body text-center">
                    <div class="success-icon">
                        <img src="~/Content/assets/img/success-tick.svg" height="100" width="80" alt="success-tick">
                    </div>
                    <p class="msg"></p><br />
                    <span class="alert alert-success">Notification Has Been Sent.</span>
                    <br /> <br />
                    <button type="button" class="btn btn-blue" data-dismiss="modal" style="width:10%; background-color:blue">OK</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Failure modal -->
    <div class="modal fade common-modal" id="failureModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-body text-center">
                    <div class="success-icon">
                        <img src="~/Content/assets/img/denied-cross.svg" alt="denied-cross">
                    </div>
                    <p style="color: #E31837; font-size: 1.111rem; font-weight: 700;">@*Error!*@</p>
                    <span style="color: #E31837; font-size: 1.111rem; font-weight: 700;" id="message"></span>
                    <br /> <br />
                    <button type="button" class="btn btn-blue" data-dismiss="modal" style="width:80%">OK</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Failure modal session expired -->
    <div class="modal fade common-modal" id="failureModalSessionExpired" tabindex="-1" role="dialog" aria-labelledby="exampleModalCenterTitle">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-body text-center">
                    <div class="success-icon">
                        <img src="~/Content/assets/img/denied-cross.svg" alt="denied-cross">
                    </div>
                    <p style="color: #E31837; font-size: 1.111rem; font-weight: 700;">@*Error!*@</p>
                    <span style="color: #E31837; font-size: 1.111rem; font-weight: 700;">Session expired. Please login again</span>
                    <br /> <br />
                    <button type="button" class="btn btn-blue" data-dismiss="modal" style="width:80%">OK</button>
                </div>
            </div>
        </div>
    </div>
}

@section scripts{

    <script type="text/javascript">

        $(".btnShow1").mousedown(function () {
            $(".pwd1").attr("type", "text");
        });
        $(".btnShow1").on("mouseleave", function () {
            $(".pwd1").attr("type", "password");
        });


        document.getElementById("successModal").onclick = function () {
         var url = '@Url.Action("Index", "SuperAdminDashboard")';
         window.location.href = url;
        };
        document.getElementById("failureModalSessionExpired").onclick = function () {
         var url = '@Url.Action("Index", "LogOut")';
         window.location.href = url;
        };

        function isNumber(evt) {
            evt = (evt) ? evt : window.event;
            var charCode = (evt.which) ? evt.which : evt.keyCode;
            if (charCode > 31 && (charCode < 48 || charCode > 57)) {
                return false;
            }
            return true;
        }

        function noCharacter(evt) {
            evt = (evt) ? evt : window.event;
            var charCode = (evt.which) ? evt.which : evt.keyCode;
            if ((charCode > 32 && charCode < 48) || (charCode > 57 && charCode < 65) || (charCode > 90 && charCode < 97) || (charCode > 122 && charCode < 127)) {
                return false;
            }
            return true;
        }
        ///for amount input number and dot only
        function NumberDot(evt) {
            var charCode = (evt.which) ? evt.which : event.keyCode
            if (charCode != 46 && charCode > 31 && (charCode < 48 || charCode > 57))
                return false;

            return true;
        }


        function checkValidation() {
            var Title = $("[name='txtTitle']").val();
            var Text = $("[name='txtText']").val();
            var ExtraInformation = $("[name='txtExtraInfo']").val();


            if ((Title.trim() == "")) {
                $("#TitleErr").html("");
                $("#TitleErr").append("<small>" + "This Field is required and cannot be empty" + "</small>");
                $("#TitleErr").show();
            }
            else {
                $("#TitleErr").hide();

            }

            if ((Text.trim() == "")) {
                $("#TextErr").html("");
                $("#TextErr").append("<small>" + "This Field is required and cannot be empty" + "</small>");
                $("#TextErr").show();
            }
            else {
                $("#TextErr").hide();

            }

             if ((ExtraInformation.trim() == "")) {
                $("#ExtraErr").html("");
                $("#ExtraErr").append("<small>" + "This Field is required and cannot be empty" + "</small>");
                $("#ExtraErr").show();
            }
            else {
                $("#ExtraErr").hide();

            }


        }



        $("#clearButton").click(function () {
            $("[name='txtTitle']").val("");
            $("[name='txtText']").val("");
            $("[name='txtExtraInfo']").val("");

        });




        $('#btnSubmit').click(function (e) {
            debugger;
            e.preventDefault();
            debugger;
            var Title = $("[name='txtTitle']").val();
            var Text = $("[name='txtText']").val();
            var ExtraInformation = $("[name='txtExtraInfo']").val();

            if ((Title != "") && (Text != "") && (ExtraInformation!=="")) {

                var dataToPost = {
                    title: Title,
                    text: Text,
                  extraInformation: ExtraInformation
                };

                e.preventDefault(); //prevent the default action
                $.ajax({

                    url: '@Url.Action("PushNotifications", "Notifications")',
                    type: "POST",
                    data: dataToPost,
                    async: false,
                    success: function (data) {
                        debugger;
                        if (data.responseCode == "200") {
                            debugger;
                            $("#ajaxResponse").html("");
                            $('#successModal').modal("show");

                            $("#TPin").val("");
                            $("#Remarks").val("");
                            $("#amount").val("");

                        }
                        //display error message
                        else {
                            $("#ajaxResponse").html("");
                            $("#message").html("");
                            $("#message").append(data.responseText);
                            if (data.responseText == "Session expired. Please login again") {
                                $('#failureModalSessionExpired').modal("show");
                            }
                            else {
                                $('#failureModal').modal("show");
                            }

                        }
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        alert('Failed to retrieve.');
                        $("#message").html("");
                        $("#message").append(jqXHR.responseText);
                        $('#failureModal').modal("show");

                    },
                    //capture the request before it was sent to server
                    beforeSend: function (jqXHR, settings) {
                        //adding some Dummy data to the request
                        settings.data += "&dummyData=whatever";
                        //disable the button until we get the response
                        $('#btnSubmit').attr("disabled", true);
                    },
                    complete: function (jqXHR, textStatus) {
                        //enable the button
                        $('#btnSubmit').attr("disabled", false);
                    }
                });
            }
            else {
                checkValidation();
                $("#message").html("");
                $("#message").append("Please Enter the required fields.");
                $('#failureModal').modal("show");

            }
        });
    </script>

}
