@model IEnumerable<MNepalWeb.Models.UserInfo>

    @{
    ViewBag.Title = "Customer Approve Password/T-Pin Reset";
    }

<section class="content-header">
    <h1>
        Customer
        @*<small>Approve Password/T-Pin Reset</small>*@
    </h1>
    <ol class="breadcrumb">
        <li><a href="#"><i class="fa fa-user"></i> @ViewContext.RouteData.Values["Controller"].ToString()</a></li>
        <li class="active"> Approve Password/T-Pin Reset</li>
    </ol>
</section>
    <section class="content">
        <!-- Main row -->
        <div class="row">

            <!-- Start -->
            <div class="col-xs-12">
                <div class="box box-primary">
                    <div class="box-header with-border">
                        <h3 class="box-title">Approve Password/T-Pin Reset</h3>
                    </div>
                    @using (Html.BeginForm("ApprovePin", "Customer", FormMethod.Get, new { @id = "ApprovePin" }))
                    {
                    <div class="box-body">
                        <div class="row">
                            <div class="form-group col-md-6">
                                <label for="MobileNumber" class="control-label">Mobile Number</label>
                                <input type="text" class="form-control col-md-6" id="MobileNumber" name="MobileNumber" placeholder="Mobile Number" maxlength="10" onkeypress="return isNumberKey(event)" required />
                            </div>
                        </div>
                        <div class="row">
                            <div class="form-group col-md-6">
                                <button type="submit" id="Search" class="btn btn-primary">Search</button>
                            </div>
                        </div>
                    </div>
                    }
                    <hr />

                    <div class="box-body" id="grid">
                        <table id="PinApprove" class="table table-striped table-bordered">
                            <thead>
                                <tr>
                                    <th>User Name</th>
                                    <th>Name</th>  
                                    <th>Account Number</th>
                                    <th>Modified Branch</th>
                                    <th>Modified By</th>                                    
                                    <th>Reset Type</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                @if (Model.Count() > 0)
                                {
                                foreach (var item in Model)
                                {
                                <tr id="@item.ClientCode">
                                    <td>@item.UserName</td>
                                    <td>@item.Name</td>
                                    <td>@item.BankAccountNumber</td>
                                    <td>@item.ModifyingBranch</td>
                                    <td>@item.ModifyingAdmin</td>
                                   @if (item.Status == "PINR")
                                    {
                                    <td title="Pin">Pin Reset</td>
                                    }
                                    else if (item.Status == "PASR")
                                    {
                                    <td title="Password">Password Reset</td>
                                    }
                                    else if (item.Status == "PPR")
                                    {
                                    <td title="Pin and Password">Both</td>
                                    }
                                    <td>
                                        <span class="fa fa-check" style="color:green" title="Approve PIN Reset" id="Approve"></span>
                                        &nbsp;&nbsp;&nbsp;
                                        <span class="fa fa-times" style="color:red" title="Revert PIN Reset" id="Revert"></span>
                                    </td>
                                </tr>
                                }
                                }
                                else
                                {
                                <tr>
                                    <td colspan="7" style="text-align:center">No Records Found</td>
                                </tr>
                                }
                            </tbody>
                        </table>
                    </div>

                </div>
            </div>
        </div>
    </section>

    @section scripts{

    <script type="text/javascript">

        function isNumberKey(evt) {
            evt = (evt) ? evt : window.event;
            var charCode = (evt.which) ? evt.which : evt.keyCode;
            if (charCode != 46 && charCode > 31
                && (charCode < 48 || charCode > 57))
                return false;

            return true;
        }


            $('#PinApprove').DataTable({
                "ordering": false,
                "filter": false,
                "sorting": false,
                "info": false,
                "lengthChange": false
            });
            $('#PinApprove tbody tr').on('click', 'td .fa', function () {

                var tr = $(this).parents('tr');
                var ClientCode = tr.attr('id');
                var Name = tr.find('td').eq(0).html();
                var PhoneNo = tr.find('td').eq(1).html();
                var ActionClick = $(this).attr('id');
                $.ajax({
                    url: '@Url.Action("PinResetApprove", "Customer")',
                    data: { ClientCode: ClientCode, Name: Name, PhoneNumber: PhoneNo, ActionClick: ActionClick },
                    type: 'GET',
                    success: function (resp) {
                        if (resp.StatusCode == 200) //success
                        {
                            alertify.success(resp.StatusMessage);
                            tr.remove();
                        }
                        else
                        {

                            alertify.error(resp.StatusMessage);
                        }
                    },
                    error: function (resp)
                    {

                        alertify.error(resp.StatusMessage);
                    }
                });
            });

        /**Validation Check */
        $('#ApprovePin').bootstrapValidator({
            //feedbackIcons: {
            //    valid: 'glyphicon glyphicon-ok',
            //    invalid: 'glyphicon glyphicon-remove',
            //    validating: 'glyphicon glyphicon-refresh'
            //},
            fields: {
                MobileNumber: {
                    validators: {
                        stringlength: {
                            min: 10,
                            max: 10,
                            message: 'Please enter valid Mobile No'

                        },
                        regexp: {
                            regexp: '^[9][8]\\d{8}$',
                            message: 'Mobile no must start with 98 and should be 10 digits'

                        }
                    }
                }


            }

        });


    </script>
    }
