
@{
    ViewBag.Title = "Branch Setup Registration";
}

<!-- =============================================== -->
<!-- Content Header (Page header) -->
<section class="content-header">
    <h1>
     Branch Setup
        @*<small>Branch Registration</small>*@
    </h1>
    <ol class="breadcrumb">
        <li><a href="#"><i class="fa fa-user"></i> Branch Setup</a></li>
        <li class="active">Branch Registration</li>
    </ol>
</section>

<!-- Main content -->
<section class="content">
    <!-- Main row -->
    <div class="row">

        @using (Html.BeginForm("CreateBranch", "BranchSetup", FormMethod.Post, new { @id = "BranchRegForm", @class = "form-horizontal" }))
        {
            @Html.AntiForgeryToken()
            @Html.ValidationSummary(true)

            if (this.ViewData["branch_message"] != null)
            {
                if (this.ViewData["message_class"].ToString() == "success_info")
                {
                    <div class="alert alert-success">
                        <button type="button" class="close" data-dismiss="alert">&times;</button>
                        <h4>Success</h4> @this.ViewData["branch_message"]
                    </div>
                }
                else
                {
                    <div class="alert alert-danger">
                        <button type="button" class="close" data-dismiss="alert">&times;</button>
                        <h4>Error</h4> @this.ViewData["branch_message"]
                    </div>
                }
            }

            <!-- Start -->
            <div class="col-xs-10">

                <div class="box box-info">
                    <div class="box-header with-border">
                        <h3 class="box-title">Branch Registration</h3>
                    </div>
                    <!-- /.box-header -->

                    <div class="box-body">
                        <div class="row">
                            <div class="col-md-10">
                                <div class="form-group">
                                    <label class="control-label col-sm-3">Branch Code:<b style="color:red;">*</b></label>
                                    <div class="col-sm-9">
                                        <input type="text" class="form-control" id="BranchCode" name="txtBranchCode" pattern=".{0,3}" maxlength="3" required title="Please use Branch Code" placeholder="Branch Code" onkeypress="return isNumberKey(event)" />
                                        <label id="check"> Please use valid Branch Code </label>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-10">
                                <div class="form-group">
                                    <label class="control-label col-sm-3">Branch Name:<b style="color:red;">*</b></label>
                                    <div class="col-sm-9">
                                        <input type="text" class="form-control" id="BranchName" name="txtBranchName" maxlength="14" required title="Please use Branch Name" placeholder="Branch Name" />
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-md-10">
                                <div class="form-group">
                                    <label class="control-label col-sm-3">Branch Location:<b style="color:red;">*</b></label>
                                    <div class="col-sm-9">
                                        <input type="text" class="form-control" id="BranchLocation" name="txtBranchLocation" required title="Please use Branch Location" placeholder="Branch Location"  maxlength="14"/>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                    <!-- /.box-body -->

                    <div class="box-footer">
                        <input type="submit" class="btn btn-primary" name="btnCommand" id="btnCommand" value="Submit" />
                    </div>
                    <!-- /.box-footer -->

                </div>
                <!-- /.box -->
                <!-- /.box-body -->

            </div>
            <!-- col-xs-8-->

            <!-- End-->
        }

    </div>
    <!-- /.row -->
</section>
<!-- /.content -->
<!-- =============================================== -->

@section scripts {

    <!-- Load jQuery and the validate plugin -->
    <script type="text/javascript" src="http://code.jquery.com/jquery-1.10.2.js"></script>

    <script src='http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js'></script>
    <script src='http://cdnjs.cloudflare.com/ajax/libs/bootstrap-validator/0.4.5/js/bootstrapvalidator.min.js'></script>

    <!-- jQuery Form Validation code -->

    <script type="text/javascript">

        function isNumberKey(evt) {
            evt = (evt) ? evt : window.event;
            var charCode = (evt.which) ? evt.which : evt.keyCode;
            if (charCode != 46 && charCode > 31
                && (charCode < 48 || charCode > 57))
                return false;
            $('#BranchRegForm').bootstrapValidator('enableFieldValidators', 'txtBranchCode', true);
            return true;
            $('#BranchRegForm').bootstrapValidator('enableFieldValidators', 'txtBranchCode', true);
        }
        
        $("#BranchCode").change(function (event) {
            
                event.preventDefault();
                var id = $('#BranchCode').val();
            if (id.length < 3) {
                debugger;
                $("#check").html("Success").hide();
                //$('#BranchRegForm').bootstrapValidator('enableFieldValidators', 'txtBranchCode', true);
                return;
                }
            else {
                    $.ajax({
                        cache: false,
                        type: "GET",
                        url: '@Url.Action("GetCheckingBranchCode", "BranchSetup")',
                        data: { "BranchCode": id },
                        success: function (data /*, textStatus*/) {
                            debugger;
                            //alert(data);
                            if (data == "True") {

                                $("#check").html("");
                                $("#check").css("color", "green");
                                $('#check').html("Valid").show();
                                $("#check").html("Success").show();
                                $('#btnCommand').show();

                            }
                            else {
                                $("#check").html("");
                                $("#check").css("color", "red");
                                $('#check').html("Valid").hide();
                                $("#check").html("Branch Code Already Exists!").show();
                                $('#btnCommand').hide();
                                $('#BranchRegForm').bootstrapValidator('enableFieldValidators', 'txtBranchCode', false);
                            }
                        },
                        error: function () {
                            alert("Data Not Found");
                        }
                    });
                }
            
        });



        $(document).ready(function () {


            /**Validation Check */
            $('#BranchRegForm').bootstrapValidator({
                feedbackIcons: {
                    valid: 'glyphicon glyphicon-ok',
                    invalid: 'glyphicon glyphicon-remove',
                    validating: 'glyphicon glyphicon-refresh'
                },
                fields: {
                    txtBranchName: {
                        validators: {
                            notEmpty: {
                                message: 'The Branch Name is required and cannot be empty'
                            },
                            stringLength: {
                                max: 14,
                                min: 4,
                                message: 'The Branch Name must be 4 to 14 letters long'
                            }
                        }
                    },
                    txtBranchCode: {
                        validators: {
                            notEmpty: {
                                message: 'The Branch Code is required and cannot be empty'
                            },
                            stringLength: {
                                max: 3,
                                min: 3,
                                message: 'The Branch Code must be 3 digits long'
                            }
                        }
                    },
                    txtBranchLocation: {
                        validators: {
                            notEmpty: {
                                message: 'The Address is required and cannot be empty'
                            },

                            stringLength: {
                                max: 14,
                                min: 4,
                                message: 'The Address must be 4 to 14 letters long'
                            }
                        }
                    }

                }
            });
        });
    </script>
}

<!-- =============================================== -->
